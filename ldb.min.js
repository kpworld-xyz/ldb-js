var Color={BLACK:4278190080,BLUE:4278190250,GREEN:4278233600,CYAN:4278233770,RED:4289331200,MAGENTA:4289331370,BROWN:4289352960,LIGHT_GRAY:4289374890,DARK_GRAY:4283782485,BRIGHT_BLUE:4283782655,BRIGHT_GREEN:4283826005,BRIGHT_CYAN:4283826175,BRIGHT_RED:4294923605,BRIGHT_MAGENTA:4294923775,BRIGHT_YELLOW:4294967125,WHITE:4294967295,LIGHT:-1,DARK:-2,DARKER:-3},Keyboard={BACKSPACE:8,TAB:9,ENTER:13,SHIFT:16,CTRL:17,ALT:18,PAUSE:19,CAPS_LOCK:20,ESCAPE:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT_ARROW:37,UP_ARROW:38,RIGHT_ARROW:39,DOWN_ARROW:40,INSERT:45,DELETE:46,KEY_0:48,KEY_1:49,KEY_2:50,KEY_3:51,KEY_4:52,KEY_5:53,KEY_6:54,KEY_7:55,KEY_8:56,KEY_9:57,KEY_A:65,KEY_B:66,KEY_C:67,KEY_D:68,KEY_E:69,KEY_F:70,KEY_G:71,KEY_H:72,KEY_I:73,KEY_J:74,KEY_K:75,KEY_L:76,KEY_M:77,KEY_N:78,KEY_O:79,KEY_P:80,KEY_Q:81,KEY_R:82,KEY_S:83,KEY_T:84,KEY_U:85,KEY_V:86,KEY_W:87,KEY_X:88,KEY_Y:89,KEY_Z:90,LEFT_META:91,RIGHT_META:92,SELECT:93,NUMPAD_0:96,NUMPAD_1:97,NUMPAD_2:98,NUMPAD_3:99,NUMPAD_4:100,NUMPAD_5:101,NUMPAD_6:102,NUMPAD_7:103,NUMPAD_8:104,NUMPAD_9:105,MULTIPLY:106,ADD:107,SUBTRACT:109,DECIMAL:110,DIVIDE:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,NUM_LOCK:144,SCROLL_LOCK:145,SEMICOLON:186,EQUALS:187,COMMA:188,DASH:189,PERIOD:190,FORWARD_SLASH:191,GRAVE_ACCENT:192,OPEN_BRACKET:219,BACK_SLASH:220,CLOSE_BRACKET:221,SINGLE_QUOTE:222},Mouse={LEFT:1,MIDDLE:1,RIGHT:2};function setToLoop(t){"boolean"==typeof t.loop?t.loop=!0:t.addEventListener("ended",function(){this.currentTime=0,this.play()},!1)}for(var PI_RAD=Math.PI/180,PI2=2*Math.PI,HALF_PI=Math.PI/2,SIN_FACTOR=360/PI2,sinLut=new Float32Array(360),i=0;i<360;i++)sinLut[i]=Math.sin(i/SIN_FACTOR);function fsin(t){return(t%=PI2)<0&&(t+=PI2),sinLut[t*SIN_FACTOR|0]}function fcos(t){return fsin(t+HALF_PI)}function lerp(t,e,o){return t+o*(e-t)}function alpha(t,e){var o=(e>>24&255)/255;return 255<<24|~~(255*((e>>16&255)/255*o+(t>>16&255)/255*(1-o)))<<16|~~(255*((e>>8&255)/255*o+(t>>8&255)/255*(1-o)))<<8|~~(255*((255&e)/255*o+(255&t)/255*(1-o)))}function Bitmap(t){var i,h=this;"object"==typeof t?(h.w=t.w,h.h=t.h,h.px=new Uint32Array(h.w*h.h)):"string"==typeof t&&((i=new Image).src=t,i.onload=function(){var t=document.createElement("canvas");t.width=i.width,t.height=i.height;var e=t.getContext("2d");e.drawImage(i,0,0),h.w=i.width,h.h=i.height,h.px=new Uint32Array(h.w*h.h);for(var o=e.getImageData(0,0,h.w,h.h).data,a=[],n=0;n<h.w*h.h;n++){for(var r=0;r<4;r++)a[r]=o[4*n+r];h.px[n]=a[3]<<24|a[0]<<16|a[1]<<8|a[2]}},i.onerror=function(){console.log("Failed to load Bitmap: "+i.src)})}Bitmap.prototype.wipe=function(t){var e=this;t=t||Color.BLUE;for(var o=0;o<e.w*e.h;o++)e.px[o]=t},Bitmap.prototype.set=function(t,e,o){var a=this;if(o||e>>24&255){var n=a.px[t];switch(e){case Color.LIGHT:a.px[t]=(8355711&n)<<1;break;case Color.DARK:a.px[t]=(16711422&n)>>1;break;case Color.DARKER:a.px[t]=(16579836&n)>>2;break;default:a.px[t]=o?alpha(n,e):e}}},Bitmap.prototype.draw=function(t,e,o,a){var n=this;a=a||!1;for(var r=0;r<t.w;r++){var i=~~e+r;if(!(i<0||i>=n.w))for(var h=0;h<t.h;h++){var s=~~o+h;s<0||s>=n.h||n.set(i+s*n.w,t.px[r+h*t.w],a)}}},Bitmap.prototype.stretch=function(t,e,o,a,n,r){var i=this;r=r||!1;for(var h=0;h<a;h++){var s=~~e+h;if(!(s<0||s>=i.w))for(var E=~~(h/(a/t.w)),A=0;A<n;A++){var f,p=~~o+A;p<0||p>=i.h||(f=~~(A/(n/t.h)),i.set(s+p*i.w,t.px[E+f*t.w],r))}}},Bitmap.prototype.crop=function(t,e,o,a,n,r,i,h){h=h||!1;for(var s=0;s<r;s++){var E=~~e+s;if(!(E<0||E>=this.w))for(var A=0;A<i;A++){var f=~~o+A;f<0||f>=this.h||this.set(E+f*this.w,t.px[s+a+(A+n)*t.w],h)}}},Bitmap.prototype.stretchCropped=function(t,e,o,a,n,r,i,h,s,E){E=E||!1;for(var A=0;A<a;A++){var f=~~e+A;if(!(f<0||f>=this.w))for(var p=~~(A/(a/h)),_=0;_<n;_++){var u,v=~~o+_;v<0||v>=this.h||(u=~~(_/(n/s)),this.set(f+v*this.w,t.px[p+r+(u+i)*t.w],E))}}},Bitmap.prototype.rotate=function(t,e,o,a,n,r){r=r||!1;for(var i=fcos(a*=PI_RAD),h=fsin(a),s=t.w*n,E=s/2,A=t.h*n,f=A/2,p=s*Math.SQRT2,_=p/2,u=A*Math.SQRT2,v=u/2,w=0;w<p*u;w++){var c,d,m=~~(w%p),R=~~(w/p),l=(I=m-_)*i+(L=R-v)*h,C=-I*h+L*i,I=Math.floor((Math.floor(l)+E)/(s/t.w)),L=Math.floor((Math.floor(C)+f)/(A/t.h));I<0||L<0||I>=t.w||L>=t.h||(d=~~o+R-u/2,0<=(c=~~e+m-p/2)&&0<=d&&c<this.w&&d<this.h&&this.set(~~c+~~d*this.w,t.px[I+L*t.w],r))}},Bitmap.prototype.fill=function(t,e,o,a,n,r){n=n||Color.BRIGHT_MAGENTA,r=r||!1;for(var i=0;i<o;i++){var h=~~t+i;if(!(h<0||h>=this.w))for(var s=0;s<a;s++){var E=~~e+s;E<0||E>=this.h||this.set(h+E*this.w,n,r)}}},Bitmap.prototype.line=function(t,e,o,a,n,r){n=n||Color.BRIGHT_YELLOW,r=r||!1,t=~~t,o=~~o,e=~~e,a=~~a;for(var i=Math.abs(o-t),h=t<o?1:-1,s=Math.abs(a-e),E=e<a?1:-1,A=(s<i?i:-s)/2,f=0;0<=t&&t<this.w&&0<=e&&e<this.h&&this.set(t+e*this.w,n,r),t!=o||e!=a;)-i<(f=A)&&(A-=s,t+=h),f<s&&(A+=i,e+=E)};var fontSheet=null,fontChars="abcdefghijklmnopqrstuvwxyz!?.,><= /+-*0123456789&^%$#~:;\"'[](){}|\\`@";function launch(o,a,r,i,t,h,s){var n=document.getElementById("game-viewport");n.width=r,n.height=i;var E=n.getContext("2d",{alpha:!1}),A=document.createElement("canvas");A.width=o,A.height=a;var f=A.getContext("2d",{alpha:!1}),p={keys:new Array(65536),mouseButtons:new Array(8),mouseX:0,mouseY:0,focused:!1,allowRepeats:!0};n.addEventListener("keydown",function(t){!p.allowRepeats&&t.repeat||(p.keys[t.keyCode]=!0)},!1),n.addEventListener("keyup",function(t){p.keys[t.keyCode]=!1},!1),n.addEventListener("mousedown",function(t){p.mouseButtons[t.button]=!0},!1),n.addEventListener("mouseup",function(t){p.mouseButtons[t.button]=!1},!1),n.addEventListener("mousemove",function(t){var e=n.getBoundingClientRect();p.mouseX=parseInt(t.clientX-e.left)/(r/o),p.mouseY=parseInt(t.clientY-e.top)/(i/a)},!1),n.addEventListener("focusout",function(t){for(var e=0;e<p.keys.length;e++)p.keys[e]=!1;p.focused=!1},!1),n.addEventListener("focusin",function(t){p.focused=!0},!1);var _=new Bitmap({w:o,h:a});t();var u=0,v=0,w=0,c=0;!function t(e){var o=0;w&&(v+=.09*(o=e-w),h(o,p),u++%60==0&&(c=Math.round(1e3/o*10)/10)),w=e,s(_,v,c);for(var a=f.createImageData(_.w,_.h),n=0;n<_.w*_.h;n++)a.data[4*n+0]=_.px[n]>>16&255,a.data[4*n+1]=_.px[n]>>8&255,a.data[4*n+2]=255&_.px[n],a.data[4*n+3]=255;f.putImageData(a,0,0),E.webkitImageSmoothingEnabled=!1,E.msImageSmoothingEnabled=!1,E.imageSmoothingEnabled=!1,E.drawImage(A,0,0,r,i),requestAnimationFrame(t)}(0)}Bitmap.prototype.text=function(t,e,o,a,n){if(a=a||Color.LIGHT_GRAY,n=n||!1,this.fontSheet||(this.fontSheet=new Bitmap("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAARAAAAAQAQMAAADks7LiAAAABlBMVEUAAAD///+l2Z/dAAABU0lEQVQoz1XPIUtEQRAH8EmLYbNMuA8x0fCCXBCDH2KDmF64JCLD4UewXjAY/B6DyD8th+nxkpiMYhLDsji7Hnc4j22/N//5k5ah1DpgvYYBWtoHn1xZiVIkIuAKZldgzvb5gTbSSWAQCXdiTszJbPUbPtbImCMHIpZCVIvh58cq85dNb42sGjm5YfaQmPZbtn0LtigoCyfTKML8jzz3WwD4C04qJLHsgg7nopMMCMZPiDk4+ju3lTYvvUIF1G6hoifuKntUL92esmquWlVVznQkotne35OJSRqGTuB/ZUMAcPMxjWQ2myVLKUlaLomFMjiEbNZIvnitTs5Pd0Q2m04mjouqJep6JF6NnnR/14iJyOMTSSkyMYcYwAhCshhn8tlt4UZ6kDQiCDNdHnvQ6YFsHih1khDhBJm2/dw9icszSq30UDWqiuo1vXjpNrvScRh+AWJ6/tPOizmGAAAAAElFTkSuQmCC")),this.fontSheet.px){t=t.toLowerCase();for(var r=0;r<t.length;r++){var i=fontChars.indexOf(t.charAt(r));if(!(i<0))for(var h=i%34*8,s=8*~~(i/34),E=0;E<8;E++){var A=~~e+8*r+E;if(!(A<0||A>=this.w))for(var f=0;f<8;f++){var p=~~o+f;p<0||p>=this.h||this.fontSheet.px[E+h+(f+s)*this.fontSheet.w]===Color.WHITE&&this.set(A+p*this.w,a,n)}}}}};